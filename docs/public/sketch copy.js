var _0x113506=_0x522c;(function(_0x3409b1,_0x33371b){var _0x2c2f75=_0x522c,_0x268872=_0x3409b1();while(!![]){try{var _0x28d776=parseInt(_0x2c2f75(0x18b))/0x1+-parseInt(_0x2c2f75(0x184))/0x2*(parseInt(_0x2c2f75(0x15b))/0x3)+-parseInt(_0x2c2f75(0x182))/0x4+parseInt(_0x2c2f75(0x192))/0x5*(parseInt(_0x2c2f75(0x183))/0x6)+-parseInt(_0x2c2f75(0x165))/0x7+-parseInt(_0x2c2f75(0x175))/0x8*(parseInt(_0x2c2f75(0x16d))/0x9)+parseInt(_0x2c2f75(0x17f))/0xa;if(_0x28d776===_0x33371b)break;else _0x268872['push'](_0x268872['shift']());}catch(_0x1f2617){_0x268872['push'](_0x268872['shift']());}}}(_0x94cd,0xf2e7e));var socket,hname=location['protocol']+'//'+location[_0x113506(0x171)];let fingers;var canvas,cnv,nText='',aText=[];let ig;var mCX='',mCY='',Sc=_0x113506(0x173),Ss='1',Shp='',Cd=0x0,Fc=_0x113506(0x173);let ds;function setup(){var _0x516dba=_0x113506;cnv=createCanvas(windowWidth,windowHeight);var _0x16ae5c=hname+_0x516dba(0x189);ds=new PenroseLSystem(),ds[_0x516dba(0x168)](0x5);}class PenroseLSystem{constructor(){var _0x2b4dc4=_0x113506;this[_0x2b4dc4(0x162)]=0x0,this[_0x2b4dc4(0x186)]=_0x2b4dc4(0x18f),this[_0x2b4dc4(0x174)]=_0x2b4dc4(0x172),this['ruleX']=_0x2b4dc4(0x164),this[_0x2b4dc4(0x17e)]='-WF++XF[+++YF++ZF]-',this[_0x2b4dc4(0x170)]='--YF++++WF[+ZF++++XF]--XF',this[_0x2b4dc4(0x15d)]=0x1cc,this['theta']=TWO_PI/0xa,this[_0x2b4dc4(0x185)]();}[_0x113506(0x168)](_0x3054df){var _0x13ca09=_0x113506;while(this[_0x13ca09(0x15e)]()<_0x3054df){this[_0x13ca09(0x16a)](this[_0x13ca09(0x15c)]);}}[_0x113506(0x185)](){var _0x35a899=_0x113506;this[_0x35a899(0x15c)]=this['axiom'],this[_0x35a899(0x193)]=this[_0x35a899(0x15d)],this[_0x35a899(0x16b)]=0x0;}[_0x113506(0x15e)](){var _0xb0b984=_0x113506;return this[_0xb0b984(0x16b)];}[_0x113506(0x16a)](){var _0x4a60df=_0x113506;let _0x516fa3='';for(let _0x3fe54a=0x0;_0x3fe54a<this[_0x4a60df(0x15c)][_0x4a60df(0x17d)];++_0x3fe54a){let _0x4669a4=this[_0x4a60df(0x15c)][_0x4a60df(0x181)](_0x3fe54a);if(_0x4669a4=='W')_0x516fa3=_0x516fa3+this['ruleW'];else{if(_0x4669a4=='X')_0x516fa3=_0x516fa3+this[_0x4a60df(0x169)];else{if(_0x4669a4=='Y')_0x516fa3=_0x516fa3+this['ruleY'];else _0x4669a4=='Z'?_0x516fa3=_0x516fa3+this['ruleZ']:_0x4669a4!='F'&&(_0x516fa3=_0x516fa3+_0x4669a4);}}}this['drawLength']=this[_0x4a60df(0x193)]*0.5,this['generations']++,this[_0x4a60df(0x15c)]=_0x516fa3;}[_0x113506(0x194)](){var _0x2d623e=_0x113506;translate(width/0x2,height/0x2),this[_0x2d623e(0x162)]+=0x14;this['steps']>this['production']['length']&&(this['steps']=this[_0x2d623e(0x15c)]['length']);for(let _0x3c7803=0x0;_0x3c7803<this[_0x2d623e(0x162)];++_0x3c7803){let _0x389af6=this['production'][_0x2d623e(0x181)](_0x3c7803);if(_0x389af6=='F'){stroke(0x0,0x3c);for(let _0x353e9b=0x0;_0x353e9b<this[_0x2d623e(0x190)];_0x353e9b++){line(0x0,0x0,0x0,-this['drawLength']),noFill(),translate(0x0,-this['drawLength']);}this[_0x2d623e(0x190)]=0x1;}else{if(_0x389af6=='+')rotate(this['theta']);else{if(_0x389af6=='-')rotate(-this['theta']);else{if(_0x389af6=='[')push();else _0x389af6==']'&&pop();}}}}}}function newDrawing(_0x57105f){noStroke(),fill(Fc),stroke(Sc),strokeWeight(Ss);}function _0x94cd(){var _0x2df3b9=['log','+YF--ZF[---WF--XF]+','6842479uaaQTy','onload','mp4','simulate','ruleX','iterate','generations','vrl','18uVVHLJ','description','circle','ruleZ','host','YF++ZF----XF[-YF----WF]++','black','ruleW','5011880DudEWA','intro','substr','rectangle','scrollTop','text','square','save','length','ruleY','23114020HsbNwQ','scrollHeight','charAt','943460ZhEAyJ','186bevvbu','127924CBQRoJ','reset','axiom','vid','Sending:\x20','/cognitive-automation/public/videos/spn001.mov','onresize','74491KNYqzZ','mov','clear','white','[X]++[X]++[X]++[X]++[X]','repeats','line','183765CQwBMs','drawLength','render','3PlgeeA','production','startLength','getAge','myCanvas.jpg','lastIndexOf','scribble','steps'];_0x94cd=function(){return _0x2df3b9;};return _0x94cd();}function newText(_0x150e1e){var _0x2cf3a3=_0x113506;fill(0xff,0x0,0x37),textSize(0x18),stroke(_0x2cf3a3(0x173)),strokeWeight(Ss),nText=_0x150e1e[_0x2cf3a3(0x187)],fill(Fc),rect(0xf,0x14,windowWidth-0x154,windowHeight-0x78),fill(Fc),text(_0x150e1e[_0x2cf3a3(0x187)],0x14,0x19,windowWidth-0x168,0x190),historyArea['value']+=_0x150e1e[_0x2cf3a3(0x187)]+'\x0a',historyArea[_0x2cf3a3(0x179)]=historyArea[_0x2cf3a3(0x180)];var _0x185dbb=_0x150e1e[_0x2cf3a3(0x16c)][_0x2cf3a3(0x177)](_0x150e1e['vrl'][_0x2cf3a3(0x160)]('.')+0x1);_0x185dbb===_0x2cf3a3(0x167)?(fingers=createVideo([_0x150e1e['vrl']]),fingers['loop']()):(fill(0xff),loadImage(_0x150e1e[_0x2cf3a3(0x16c)],_0x37a2e8=>{image(_0x37a2e8,0x19,0xdc,0x15e,0xfa);}));if(nText==_0x2cf3a3(0x17b))stroke(Sc),strokeWeight(Ss),noFill(),square(0x64,0x78,0xff);else{if(nText==_0x2cf3a3(0x178))stroke(Sc),strokeWeight(Ss),rect(0x14a,0xc8,0x69,0x9b);else nText==_0x2cf3a3(0x18d)&&clear();}}function mouseDragged(){var _0x3ffd7d=_0x113506;console[_0x3ffd7d(0x163)](_0x3ffd7d(0x188)+mouseX+','+mouseY);var _0x3f77ea={'x':mouseX,'y':mouseY,'px':pmouseX,'py':pmouseY};stroke(Sc),strokeWeight(Ss),fill(Fc),Shp==_0x3ffd7d(0x161)&&line(mouseX,mouseY,pmouseX,pmouseY),Shp==_0x3ffd7d(0x16f)&&circle(mouseX,mouseY,Cd),Shp==_0x3ffd7d(0x17b)&&square(mouseX,mouseY,Cd);}window[_0x113506(0x18a)]=function(){};function draw(){var _0xc5943d=_0x113506;stroke(Sc),strokeWeight(Ss),fill(Fc),Shp==_0xc5943d(0x17c)&&(background(0xff),save(cnv,_0xc5943d(0x15f)),Shp=''),Shp==_0xc5943d(0x166)&&(textSize(0x28),stroke(0x0),strokeWeight(0x3),fill(''),strokeWeight(0x1),ds[_0xc5943d(0x194)]()),Shp==_0xc5943d(0x176)&&(textSize(0x28),stroke(0x3),fill(Fc),strokeWeight(0x3),fill(''),text('Cognitive\x20Solutions',0x152,0x1f4),rl=hname+iUrl);}function mousePressed(){var _0x259b99=_0x113506;fill(0xff,0x0,0x37),textSize(0xc),stroke(Sc),fill(Fc),strokeWeight(Ss),mCX=mouseX,mCY=mouseY;var _0x1ebcee=mCX+'\x20'+mCY;Shp==_0x259b99(0x191)&&(noFill(),circle(mCX,mCY,0x14),circle(mouseX,mouseY,0x14),fill(Fc),circle(mouseX,mouseY,0xa),circle(mCX,mCY,0xa));Shp==_0x259b99(0x17a)&&text(Cd,mouseX,mouseY,windowWidth-0x17c,0x1e0);var _0x13f9dc={'vid':nText};}function _0x522c(_0x1858c0,_0x5bc2ce){var _0x94cd02=_0x94cd();return _0x522c=function(_0x522c4f,_0xa93423){_0x522c4f=_0x522c4f-0x15b;var _0x13271e=_0x94cd02[_0x522c4f];return _0x13271e;},_0x522c(_0x1858c0,_0x5bc2ce);}function mouseReleased(){var _0x2932aa=_0x113506;mRX=mouseX,mRY=mouseY;var _0x134cab=mRX+'\x20'+mRY;textSize(0xc),stroke(Sc),strokeWeight(Ss);var _0x532b3b=mouseX+'\x20'+mouseY;Shp==_0x2932aa(0x16f)&&circle(mouseX,mouseY,Cd);Shp=='square'&&square(mouseX,mouseY,Cd);Shp==_0x2932aa(0x191)&&(fill(Fc),line(mCX,mCY,mRX,mRY));var _0x3f65b3={'vid':nText};function _0x540843(_0x5bb5fc,_0x451562){var _0x14fb90=_0x2932aa;fill(0xff,0x0,0x37),textSize(0x18),stroke(_0x14fb90(0x18e)),strokeWeight(0x1),fill(0xff),rect(0xa,0xf,windowWidth-0x145,windowHeight-0x78),fill(0xff,0x0,0x37),text(nextImage[_0x14fb90(0x16e)],0x50,0x32,windowWidth,windowHeight),rl=hname+_0x451562;var _0x273f39=_0x451562[_0x14fb90(0x177)](_0x451562[_0x14fb90(0x160)]('.')+0x1);_0x273f39===_0x14fb90(0x167)||_0x273f39===_0x14fb90(0x18c)?fingers=createVideo([rl]):(fill(0xff),loadImage(rl,_0x181137=>{image(_0x181137,0x19,0xdc,0x15e,0xfa);}));if(_0x5bb5fc=='square')stroke(Sc),strokeWeight(0x2),noFill(),square(0x64,0x78,0xff);else{if(_0x5bb5fc==_0x14fb90(0x178))stroke('green'),strokeWeight(0x2),rect(0x14a,0xc8,0x69,0x9b);else _0x5bb5fc==_0x14fb90(0x18d)&&clear();}var _0x4ebb14={'vid':_0x5bb5fc,'vrl':rl};}}
var socket;

var hname = location.protocol+'//'+	location.host;
// alert(hname);

let fingers;

var canvas;

var cnv;

var nText = '';

var aText = [];

var iUrl = '';

let ig; // Declare variable 'img'.

var mCX = '';

var mCY = '';

var Sc = 'black';

var Ss = '1';

var Shp = '';

var Cd = 0;

var Fc = 'black';

let ds;

function setup(){
	// alert('setup');
	cnv = createCanvas(windowWidth,windowHeight);

	// background(51)
  	// fingers = createVideo(['assets/LittleRedRidingHood_video.mp4']);
  	// fingers.hide();
	socket = io.connect(hname);
	socket.on('mouse', newDrawing);
	socket.on('vid', newText);
	// p5eg();
	ds = new PenroseLSystem();
	//please, play around with the following line
	ds.simulate(5);

}





// function setup() {
//   createCanvas(710, 400);
//   ds = new PenroseLSystem();
//   //please, play around with the following line
//   ds.simulate(5);
// }

// function draw() {
//   background(255);
//   ds.render();
// }

class PenroseLSystem {
	constructor() {
		this.steps = 0;

		//these are axiom and rules for the penrose rhombus l-system
		//a reference would be cool, but I couldn't find a good one
		this.axiom = "[X]++[X]++[X]++[X]++[X]";
		this.ruleW = "YF++ZF----XF[-YF----WF]++";
		this.ruleX = "+YF--ZF[---WF--XF]+";
		this.ruleY = "-WF++XF[+++YF++ZF]-";
		this.ruleZ = "--YF++++WF[+ZF++++XF]--XF";

		//please play around with the following two lines
		this.startLength = 460.0;
		this.theta = TWO_PI / 10.0; //36 degrees, try TWO_PI / 6.0, ...
		this.reset();
	}
	simulate(gen) {
		while (this.getAge() < gen) {
			this.iterate(this.production);
		}
	}
	reset() {
		this.production = this.axiom;
		this.drawLength = this.startLength;
		this.generations = 0;
	}
	getAge() {
		return this.generations;
	}
	//apply substitution rules to create new iteration of production string
	iterate() {
		let newProduction = "";

		for (let i = 0; i < this.production.length; ++i) {
			let step = this.production.charAt(i);
			//if current character is 'W', replace current character
			//by corresponding rule
			if (step == 'W') {
				newProduction = newProduction + this.ruleW;
			}
			else if (step == 'X') {
				newProduction = newProduction + this.ruleX;
			}
			else if (step == 'Y') {
				newProduction = newProduction + this.ruleY;
			}
			else if (step == 'Z') {
				newProduction = newProduction + this.ruleZ;
			}
			else {
				//drop all 'F' characters, don't touch other
				//characters (i.e. '+', '-', '[', ']'
				if (step != 'F') {
					newProduction = newProduction + step;
				}
			}
		}

		this.drawLength = this.drawLength * 0.5;
		this.generations++;
		this.production = newProduction;
	}
	//convert production string to a turtle graphic
	render() {
		translate(width / 2, height / 2);

		this.steps += 20;
		if (this.steps > this.production.length) {
			this.steps = this.production.length;
		}

		for (let i = 0; i < this.steps; ++i) {
			let step = this.production.charAt(i);

			//'W', 'X', 'Y', 'Z' symbols don't actually correspond to a turtle action
			if (step == 'F') {
				stroke(0, 60);
				for (let j = 0; j < this.repeats; j++) {
					line(0, 0, 0, -this.drawLength);
					noFill();
					translate(0, -this.drawLength);
				}
				this.repeats = 1;
			}
			else if (step == '+') {
				rotate(this.theta);
			}
			else if (step == '-') {
				rotate(-this.theta);
			}
			else if (step == '[') {
				push();
			}
			else if (step == ']') {
				pop();
			}
		}
	}
}








function newDrawing(data){
	noStroke();
	fill(Fc);
	//ellipse(data.x, data.y, 16, 16);
	stroke(Sc);
	strokeWeight(Ss);
	//circle(mouseX, mouseY, 1, 1);
	// line(data.x, data.y, data.px, data.py);	
}


function newText(vdata){

	fill(255,0,55);
	textSize(24);

	stroke('black');
	strokeWeight(Ss);
	nText = vdata.vid;
  	fill(Fc);
	rect(15, 20, windowWidth - 340, windowHeight - 120);
	fill(Fc);
 	text(vdata.vid, 20, 25, windowWidth - 360, 400);
 	//responsiveVoice.speak(vdata.vid);

 	historyArea.value += vdata.vid + "\n";                 
    historyArea.scrollTop = historyArea.scrollHeight; 	
	var extension = vdata.vrl.substr((vdata.vrl.lastIndexOf('.') +1));

	if (extension === 'mp4'){
	  	fingers = createVideo([vdata.vrl]);
	 //fingers.hide();		

 	 fingers.loop();

 	 // filter(GRAY);
 	 // image(fingers, 150, 150);
	} else {
	//text(vdata.vid, 10, 10, 600, 400);
	//ig = loadImage(vdata.vrl);
		fill(255);
		//rect(15, 200, windowWidth - 340, 300);
		loadImage(vdata.vrl, img => {
	    	image(img, 25, 220, 350, 250);
	    });

	}
 	 if (nText == 'square'){
	 	stroke(Sc);
		strokeWeight(Ss);
		noFill();
		square(100, 120, 255);
	 } else if (nText == 'rectangle'){
	 	stroke(Sc);
		strokeWeight(Ss);
	 	rect(330, 200, 105, 155);
	 } else if (nText == 'clear'){
	 	clear();
	 }
	
}

function mouseDragged(){
	console.log('Sending: '+ mouseX +',' + mouseY);
	var data = {
		x: mouseX,
		y: mouseY,
		px: pmouseX,
		py: pmouseY
	}
	socket.emit('mouse', data);
	//fill(255, 0, 100);
	// circle(mouseX, mouseY, 36, 36);
	stroke(Sc);
	strokeWeight(Ss);
	fill(Fc);


	if (Shp == "scribble") {
		line(mouseX, mouseY, pmouseX, pmouseY);
	}
	if (Shp == "circle") {
		circle(mouseX, mouseY, Cd);
	}
	if (Shp == "square") {
		square(mouseX, mouseY, Cd);
	}

}
window.onresize = function() {
//   canvas.size(windowWidth - 300, windowHeight - 100);
  //background(51)
};


function draw() {
	
	stroke(Sc);
	strokeWeight(Ss);
	fill(Fc)
	// line(mouseX, mouseY, pmouseX, pmouseY);

	if (Shp == "save") {
		background(255);
		save(cnv, 'myCanvas.jpg');
		Shp = '';
	}
	if (Shp == "text") {
		text(Cd, 100, 100, windowWidth - 380, 480);
	}
	if (Shp == "onload") {
		textSize(40);
		// fill(255,0,55);
		stroke(0);
		// image('/public/images/thumbnail.jpeg', 25, 220, 350, 250);
		// loadImage('/public/images/thumbnail.jpeg', img => {
	    // 	image(img, 25, 220, 350, 250);
	    // });
		// fill(Fc);
		strokeWeight(3);
		fill('');
		// stroke(Cyan);
		// text("With Extreme-Spartan", 450,  90);
		// text("Cognitive Solutions", 430,  500);
		// text("Welcome to the World of Cognitive Computing!", 150,  40);
		// background(255);
		// responsiveVoice.speak("Welcome to the World of Cognitive Computing!");
		strokeWeight(1);
		ds.render();
	}	
	if (Shp == "intro") {
		textSize(40);
		// fill(255,0,55);
		stroke(3);
		loadImage('/public/images/thumbnail.jpeg', img => {
	    	image(img, 25, 220);
	    });
		// fill(Fc);
		strokeWeight(3);
		fill('');
		// stroke(Cyan);
		// text(Cd, 350,  90);
		text("Cognitive Solutions", 338,  500);

		// background(255);
		// strokeWeight(1);
		// ds.render();
	}

}



function mousePressed() {
	// alert(s)
	
	fill(255,0,55);
	textSize(12);
	stroke(Sc);
	fill(Fc);
	strokeWeight(Ss);

	mCX = mouseX;
	mCY = mouseY;
	var cxy = mCX+' '+mCY;
	if (Shp == "line") {
		noFill();
		circle(mCX, mCY, 20);
		circle(mouseX, mouseY, 20);

		fill(Fc)
		// line(mCX, mCY, mRX, mRY);
		circle(mouseX, mouseY, 10);
		circle(mCX, mCY, 10);
	}
	if (Shp == "text") {
		text(Cd, mouseX, mouseY, windowWidth - 380, 480);
	}
	// alert(cxy);
	//text(cxy, mouseX, mouseY, windowWidth - 380, 480);
	// circle(mouseX, mouseY, 45);
    var vdata = {
		vid: nText
	}

  //fingers.loop(); // set the video to loop and start playing
}

function mouseReleased() {
	mRX = mouseX;
	mRY = mouseY;
	var crxy = mRX+' '+mRY;
	// alert(crxy);
	//fill(255,0,55);
	textSize(12);	
	stroke(Sc);
	strokeWeight(Ss);
	var cxy = mouseX+' '+mouseY;


	if (Shp == "circle") {
		circle(mouseX, mouseY, Cd);
	}
	if (Shp == "square") {
		square(mouseX, mouseY, Cd);
	}
	if (Shp == "line") {
		// noFill();
		// circle(mCX, mCY, 20);
		// circle(mouseX, mouseY, 20);

		fill(Fc)
		line(mCX, mCY, mRX, mRY);
		// circle(mouseX, mouseY, 10);
		// circle(mCX, mCY, 10);
	}
	// //text(cxy, mouseX, mouseY, windowWidth - 380, 480);

	// text(uname, mouseX, mouseY, windowWidth - 380, 480);
	//stroke('blue');
	//strokeWeight(2);
	//line(pmouseX, pmouseY, mCX, mCY);

	// line(mCX, mCY, mRX, mRY);

    var vdata = {
		vid: nText
	}
	//circle(mouseX, mouseY, 20);
	//socket.emit('vid', vdata);

	function narrateText(nText, iUrl) {

		fill(255,0,55);
		textSize(24);
	
		stroke('white');
		strokeWeight(1);
		//noFill();
		fill(255);
		rect(10, 15, windowWidth - 325, windowHeight - 120);
		fill(255,0,55);
		 text(nText, 18, 25, windowWidth - 360, 400);
		 //	responsiveVoice.speak(nText);
		rl = hname +'/protected/KathaCms'+iUrl;
		//rl = 'http://localhost:3000/KathaCms/content/topic/showjackets.jpg'
		var extension = iUrl.substr((iUrl.lastIndexOf('.') +1));
		if (extension === 'mp4'){
			  fingers = createVideo([rl]);
		 //fingers.hide();		
	
		  fingers.play();
	
		  // filter(GRAY);
		  // image(fingers, 150, 150);
		} else {
			fill(255);
		//rect(15, 200, windowWidth - 340, 300);
		  loadImage(rl, img => {
			image(img, 25, 220, 350, 250);
		  });
		}
		 if (nText == 'square'){
			 stroke(Sc);
			strokeWeight(2);
			noFill();
			square(100, 120, 255);
		 } else if (nText == 'rectangle'){
			 stroke('green');
			strokeWeight(2);
			 rect(330, 200, 105, 155);
		 } else if (nText == 'clear'){
			 clear();
		 }
	
		var vdata = {
			vid: nText,
			vrl: rl
		}
		//circle(mouseX, mouseY, 20);
		// socket.emit('vid', vdata);
	
	}

  //fingers.loop(); // set the video to loop and start playing
}
